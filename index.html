<!DOCTYPE html>
<html lang="es">

<head>
<meta charset="UTF-8">
<title>Login Inteligente</title>

<style>

body{
background:rgb(255, 255, 255);
font-family:Arial;
margin:0;
height:100vh;
display:flex;
justify-content:center;
align-items:center;
color:rgb(104, 175, 126);
}

#switch{
display:none;
}

.container{
perspective:1200px;
position:relative;
}

.card{
width:380px;
height:420px;
position:relative;
transform-style:preserve-3d;
transition:1s;
}

#switch:checked ~ .container .card{
transform:rotateY(180deg);
}

.side{
position:absolute;
width:100%;
height:100%;
border-radius:20px;
background:rgb(255, 255, 255);
padding:25px;
backface-visibility:hidden;

box-shadow:
0 0 10px rgb(141, 194, 136),
0 0 20px rgb(21, 255, 0),
0 0 40px rgb(21, 255, 0);

animation:borde 3s linear infinite;
}

@keyframes borde{
0%{box-shadow:0 0 10px rgb(21, 126, 12);}
50%{box-shadow:0 0 50px rgb(21, 255, 0);}
100%{box-shadow:0 0 10px rgb(21, 255, 0);}
}

.register{
transform:rotateY(180deg);
}

h2{
text-align:center;
}

input{
width:95%;
padding:12px;
margin-top:10px;
border-radius:8px;
border:2px solid rgb(21, 255, 0);
background:rgb(240, 255, 242);
color:rgb(81, 255, 0);
}

button{
margin-top:20px;
width:100%;
padding:13px;
border:none;
border-radius:10px;
background:linear-gradient(to right,#39ff02,#88ff00);
color:rgb(255, 255, 255);
font-size:16px;
cursor:pointer;
}

.sideButton{
position:absolute;
top:50%;
transform:translateY(-50%);
width:80px;
height:250px;
cursor:pointer;
}

.arrow{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
font-size:40px;
opacity:0;
transition:0.3s;
}

.container:hover .arrow{
opacity:1;
}

.left{ left:-110px; }
.right{ right:-110px; }

#switch:not(:checked) ~ .container .left{
display:none;
}

#switch:checked ~ .container .right{
display:none;
}

.notify{
position:absolute;
top:30%;
width:220px;
padding:15px;
border-radius:10px;
background:#ffffff;
border:2px solid rgba(21, 255, 0);
box-shadow:0 0 10px rgb(21, 255, 0);
font-size:14px;
display:none;
}

.notifyLogin{
left:20px;
}

.notifyRegister{
right:20px;
}

</style>

</head>

<body>


<input type="checkbox" id="switch">


<div class="container">


<label for="switch" class="sideButton left">
<div class="arrow">‚óÄ</div>
</label>

<label for="switch" class="sideButton right">
<div class="arrow">‚ñ∂</div>
</label>


<div class="card">


<div class="side">

<h2>INICIAR SESI√ìN</h2>

Correo
<input id="correoLogin" type="text">

Contrase√±a
<input id="passLogin" type="password">

<button onclick="login()">
Entrar
</button>

</div>


<div class="side register">

<h2>REGISTRO</h2>

Correo
<input id="correoReg" type="text">

Contrase√±a
<input id="passReg" type="password">

<button onclick="registro()">
Crear Cuenta
</button>

</div>

</div>

</div>


<div class="notify notifyLogin" id="avisosLogin"></div>
<div class="notify notifyRegister" id="avisosReg"></div>


<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
getDatabase,
ref,
set,
get
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDSExbNQt2glE3uPIYIESbpR-WMyG2ts0M",
  authDomain: "act23-547b9.firebaseapp.com",
  databaseURL: "https://act23-547b9-default-rtdb.firebaseio.com",
  projectId: "act23-547b9",
  storageBucket: "act23-547b9.firebasestorage.app",
  messagingSenderId: "329465558346",
  appId: "1:329465558346:web:0f7667ed31a03c0589fdb3"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* Mostrar avisos */
function mostrarAviso(elemento,texto){
    elemento.style.display="block";
    elemento.innerHTML=texto;
    setTimeout(()=>{ elemento.style.display="none"; },4000);
}

/* Validar correo */
function validarCorreo(correo){
    const regex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return regex.test(correo);
}

/* Hash seguro */
async function hashPassword(password){
    const encoder=new TextEncoder();
    const data=encoder.encode(password);
    const hashBuffer=await crypto.subtle.digest("SHA-256",data);
    return Array.from(new Uint8Array(hashBuffer))
    .map(b=>b.toString(16).padStart(2,"0")).join("");
}

/* REGISTRO */
window.registro = async function(){

    let correo = document.getElementById("correoReg").value.trim();
    let pass = document.getElementById("passReg").value;
    let avisos = document.getElementById("avisosReg");
    let texto = "";

    // Validar correo vac√≠o
    if(correo === ""){
        texto += "<div>Debe escribir un correo</div>";
    }

    // Detectar @
    if(!correo.includes("@")){
        texto += "<div>Falta el s√≠mbolo @</div>";
    }

    // Detectar gmail.com
    if(!correo.endsWith("gmail.com")){
        texto += "<div>Debe contener gmail.com</div>";
    }

    // Validar contrase√±a vac√≠a
    if(pass === ""){
        texto += "<div>Debe escribir una contrase√±a</div>";
    }

    // Longitud m√≠nima
    if(pass !== "" && pass.length < 8){
        texto += "<div>M√≠nimo 8 caracteres</div>";
    }

    if(texto !== ""){
        mostrarAviso(avisos,texto);
        return;
    }

    const usuariosRef = ref(db,"usuarios");
    const snapshot = await get(usuariosRef);
    let datos = snapshot.exists()? snapshot.val() : {};

    // Verificar duplicado
    for(let key in datos){
        if(datos[key].correo === correo){
            mostrarAviso(avisos,"‚úñ Correo ya registrado");
            return;
        }
    }

    let newId = Object.keys(datos).length + 1;
    let passHash = await hashPassword(pass);

    await set(ref(db,"usuarios/user_"+newId),{
        uid:newId,
        correo:correo,
        password:passHash
    });

    mostrarAviso(avisos,"‚úî Cuenta creada correctamente");
}

/* LOGIN */window.login = async function(){

    let correo = document.getElementById("correoLogin").value.trim();
    let pass = document.getElementById("passLogin").value;
    let avisos = document.getElementById("avisosLogin");
    let texto = "";

    if(correo === ""){
        texto += "<div>Debe escribir un correo</div>";
    }

    if(!correo.includes("@")){
        texto += "<div>Falta el s√≠mbolo @</div>";
    }

    if(!correo.endsWith("gmail.com")){
        texto += "<div>Debe contener gmail.com</div>";
    }

    if(pass === ""){
        texto += "<div>Debe escribir una contrase√±a</div>";
    }

    if(pass !== "" && pass.length < 8){
        texto += "<div>Contrase√±a inv√°lida</div>";
    }

    if(texto !== ""){
        mostrarAviso(avisos,texto);
        return;
    }

    const snapshot = await get(ref(db,"usuarios"));

    if(!snapshot.exists()){
        mostrarAviso(avisos,"‚úñ No hay usuarios registrados");
        return;
    }

    let datos = snapshot.val();
    let usuario = null;

    for(let key in datos){
        if(datos[key].correo === correo){
            usuario = datos[key];
            break;
        }
    }

    if(!usuario){
        mostrarAviso(avisos,"‚úñ Usuario no encontrado");
        return;
    }

    let passHash = await hashPassword(pass);

  if(usuario.password === passHash){

        mostrarAviso(avisos,"‚úî Inicio correcto");

        // üî• Guardar sesi√≥n b√°sica
        localStorage.setItem("usuario", usuario.correo);

        // üî• Redireccionar a login.html
        setTimeout(()=>{
            window.location.href = "loggin.html";
        },1000);

    }else{
        mostrarAviso(avisos,"‚úñ Contrase√±a incorrecta");
    }
}
</script>


