<!DOCTYPE html>
<html lang="es">

<head>
<meta charset="UTF-8">
<title>Login Inteligente Seguro</title>

<style>

body{
background:black;
font-family:Arial;
margin:0;
height:100vh;
display:flex;
justify-content:center;
align-items:center;
color:white;
}

#switch{
display:none;
}

.container{
perspective:1200px;
position:relative;
}

.card{
width:380px;
height:420px;
position:relative;
transform-style:preserve-3d;
transition:1s;
}

#switch:checked ~ .container .card{
transform:rotateY(180deg);
}

.side{
position:absolute;
width:100%;
height:100%;
border-radius:20px;
background:black;
padding:25px;
backface-visibility:hidden;

box-shadow:
0 0 10px #00ff00,
0 0 20px #00ff00,
0 0 40px #00ff00;

animation:borde 3s linear infinite;
}

@keyframes borde{
0%{box-shadow:0 0 10px #00ff00;}
50%{box-shadow:0 0 50px #00ff00;}
100%{box-shadow:0 0 10px #00ff00;}
}

.register{
transform:rotateY(180deg);
}

h2{
text-align:center;
}

input{
width:95%;
padding:12px;
margin-top:10px;
border-radius:8px;
border:2px solid #00ff00;
background:black;
color:white;
}

button{
margin-top:20px;
width:100%;
padding:13px;
border:none;
border-radius:10px;
background:linear-gradient(to right,#006400,#00ff00);
color:white;
font-size:16px;
cursor:pointer;
}

.sideButton{
position:absolute;
top:50%;
transform:translateY(-50%);
width:80px;
height:250px;
cursor:pointer;
}

.arrow{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
font-size:40px;
opacity:0;
transition:0.3s;
}

.container:hover .arrow{
opacity:1;
}

.left{ left:-110px; }
.right{ right:-110px; }

#switch:not(:checked) ~ .container .left{
display:none;
}

#switch:checked ~ .container .right{
display:none;
}

.notify{
position:absolute;
top:30%;
width:220px;
padding:15px;
border-radius:10px;
background:#111;
border:2px solid #00ff00;
box-shadow:0 0 10px #00ff00;
font-size:14px;
display:none;
}

.notifyLogin{
left:20px;
}

.notifyRegister{
right:20px;
}

</style>

</head>

<body>

<input type="checkbox" id="switch">

<div class="container">

<label for="switch" class="sideButton left">
<div class="arrow">â—€</div>
</label>

<label for="switch" class="sideButton right">
<div class="arrow">â–¶</div>
</label>

<div class="card">

<div class="side">

<h2>INICIAR SESIÃ“N</h2>

Correo
<input id="correoLogin" type="text">

ContraseÃ±a
<input id="passLogin" type="password">

<button onclick="login()">
Entrar
</button>

</div>

<div class="side register">

<h2>REGISTRO</h2>

Correo
<input id="correoReg" type="text">

ContraseÃ±a
<input id="passReg" type="password">

<button onclick="registro()">
Crear Cuenta
</button>

</div>

</div>

</div>

<div class="notify notifyLogin" id="avisosLogin"></div>
<div class="notify notifyRegister" id="avisosReg"></div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
getDatabase,
ref,
set,
get,
child
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDSExbNQt2glE3uPIYIESbpR-WMyG2ts0M",
  authDomain: "act23-547b9.firebaseapp.com",
  databaseURL: "https://act23-547b9-default-rtdb.firebaseio.com",
  projectId: "act23-547b9",
  storageBucket: "act23-547b9.firebasestorage.app",
  messagingSenderId: "329465558346",
  appId: "1:329465558346:web:0f7667ed31a03c0589fdb3"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

function mostrarAviso(elemento,texto){
elemento.style.display="block";
elemento.innerHTML=texto;
setTimeout(()=>{
elemento.style.display="none";
},5000);
}

// ðŸš€ FunciÃ³n para hashear contraseÃ±as
async function hashPassword(password){
    const encoder = new TextEncoder();
    const data = encoder.encode(password);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    const hashHex = hashArray.map(b => b.toString(16).padStart(2,'0')).join('');
    return hashHex;
}

// ðŸ”‘ FunciÃ³n para generar token de sesiÃ³n
function generarToken(){
    return crypto.randomUUID();
}

/* REGISTRO */
window.registro = async function(){
let correo = document.getElementById("correoReg").value;
let pass = document.getElementById("passReg").value;
let avisos = document.getElementById("avisosReg");
let texto = "";

if(!correo.includes("@"))
texto+="<div>Falta @</div>";
else if(!correo.includes("gmail.com"))
texto+="<div>Falta gmail.com</div>";
if(pass.length<8)
texto+="<div>Minimo 8 caracteres</div>";

if(texto!=""){
mostrarAviso(avisos,texto);
return;
}

let id = correo.replace(".", "_");
let passHash = await hashPassword(pass); // âœ… hash seguro

// Guardar usuario con hash y campo privado opcional
set(ref(db,"usuarios/"+id),{
correo: correo,
password: passHash,
privado: false
});

mostrarAviso(avisos,"âœ” Cuenta creada correctamente");
}

/* LOGIN */
window.login = async function(){
let correo = document.getElementById("correoLogin").value;
let pass = document.getElementById("passLogin").value;
let avisos = document.getElementById("avisosLogin");
let texto = "";

if(!correo.includes("@"))
texto+="<div>Falta @</div>";
else if(!correo.includes("gmail.com"))
texto+="<div>Falta gmail.com</div>";
if(pass.length<8)
texto+="<div>Minimo 8 caracteres</div>";

if(texto!=""){
mostrarAviso(avisos,texto);
return;
}

let id = correo.replace(".", "_");
let passHash = await hashPassword(pass);

get(child(ref(db),"usuarios/"+id)).then(snapshot=>{
    if(snapshot.exists()){
        let datos = snapshot.val();
        if(datos.password === passHash){
            mostrarAviso(avisos,"âœ” Inicio correcto");
            // generar token y guardar
            const token = generarToken();
            localStorage.setItem("authToken", token);
            localStorage.setItem("userId", id);

            setTimeout(()=>{
                window.location.href="loggin.html"; // ruta protegida
            },1000);
        } else {
            mostrarAviso(avisos,"âœ– ContraseÃ±a incorrecta");
        }
    } else {
        mostrarAviso(avisos,"âœ– No has creado cuenta");
    }
});
}



const token = localStorage.getItem('authToken');
const userId = localStorage.getItem('userId');

if(!token || !userId){
  
    window.location.href = "index.html";
}

</script>

</body>
</html>






